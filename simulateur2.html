<h2>ðŸŽ² Simulateur de moyennes et Ã©carts-types (loi normale N(30, 0.5))</h2>

<button onclick="nouvelleSimulation()">ðŸŽ¯ Tirer un Ã©chantillon (100 valeurs)</button>
<button onclick="exporterCSV()">ðŸ’¾ Exporter en CSV</button>

<p id="resume"></p>

<table id="resultats" border="1" style="border-collapse: collapse; margin-top: 10px;">
  <thead>
    <tr><th>Simulation</th><th>Moyenne</th><th>Ã‰cart-type</th></tr>
  </thead>
  <tbody></tbody>
</table>
<script scr = "chartmin.js"></script>
<script>
// --- ParamÃ¨tres de la population ---
const mu = 30;
const sigma = 0.5;
const tailleEchantillon = 100;
const populationSize = 100000;

// --- GÃ©nÃ©ration de la population ---
let population = [];
for (let i = 0; i < populationSize; i++) {
  // gÃ©nÃ©ration normale par mÃ©thode Box-Muller
  let u = Math.random();
  let v = Math.random();
  let z = Math.sqrt(-2 * Math.log(u)) * Math.cos(2 * Math.PI * v);
  population.push(mu + sigma * z);
}

// --- Tableau des rÃ©sultats (moyenne, Ã©cart-type) ---
let resultats = [];

// --- Tirage d'un Ã©chantillon ---
function nouvelleSimulation() {
  let echantillon = [];
  for (let i = 0; i < tailleEchantillon; i++) {
    const index = Math.floor(Math.random() * population.length);
    echantillon.push(population[index]);
  }

  const moyenne = echantillon.reduce((a, b) => a + b, 0) / echantillon.length;
  const variance = echantillon.reduce((a, b) => a + Math.pow(b - moyenne, 2), 0) / (echantillon.length - 1);
  const ecartType = Math.sqrt(variance);

  resultats.push({ moyenne, ecartType });
  afficherResultats();
}

// --- Affichage du tableau ---
function afficherResultats() {
  const tbody = document.querySelector("#resultats tbody");
  tbody.innerHTML = "";

  resultats.forEach((r, i) => {
    const row = `<tr>
      <td>${i + 1}</td>
      <td>${r.moyenne.toFixed(3)}</td>
      <td>${r.ecartType.toFixed(3)}</td>
    </tr>`;
    tbody.innerHTML += row;
  });

  document.getElementById("resume").innerHTML =
    `Nombre de simulations : <b>${resultats.length}</b>`;
}

// --- Export CSV ---
function exporterCSV() {
  if (resultats.length === 0) {
    alert("Aucune simulation Ã  exporter !");
    return;
  }
  let csv = "Simulation,Moyenne,Ecart-type\n";
  resultats.forEach((r, i) => {
    csv += `${i + 1},${r.moyenne.toFixed(5)},${r.ecartType.toFixed(5)}\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = "resultats_simulations.csv";
  a.click();
  URL.revokeObjectURL(url);
}
</script>
